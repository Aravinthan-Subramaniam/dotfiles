#!/usr/bin/env bash

# set up a backup place
backup_folder=$HOME/dotfiles_backup

# ask the user if they want to proceed
echo "This script will place a bunch of files in the right places so that"
echo "things like zsh, vim, tmux will pick up the right configuration."
echo "This will change files that you might have edited but those files"
echo "will be backed up $backup_folder. Do you wish to continue?"
select yn in "Yes" "No"; do
  case $yn in
    Yes ) break;;
    No ) exit;;
  esac
done

# store the paths of where these files should be
zshrc_location=$HOME/.zshrc
tmuxconf_location=$HOME/.tmux.conf
vimrc_location=$HOME/.vimrc

# what platform are we running on
platform=`uname`

case "$platform" in
  Darwin*)
    echo "Detected OS to be macOS"
    exit 0
    ;;
  *)
    echo "The OS is not supported by this repo. Exiting."
    exit 2
    ;;
esac

function backup_and_replace_file() {
  file_to_replace=$1
  location=$2
  platform=$3

  if [[ -f $location ]]; then
    echo "Found a $file_to_replace in $USER's home directory"
    echo "Backing it up at $backup_folder/$file_to_replace"

    mkdir -p $backup_folder
    mv $HOME/$file_to_replace $backup_folder/$file_to_replace
  fi

  rm $HOME/$file_to_replace
  mv $platform/$file_to_replace $HOME/$file_to_replace
}


function backup_and_replace_zshrc() {
  platform=$1
  backup_and_replace_file ".zshrc" "$zshrc_location" "$1"
}
